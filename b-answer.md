#題材B 商店データベース

## Level1(本誌 第1章~第2章)

問題1　正解
商品テーブルの全てのデータを抽出する「※」を用いないこと

解答1
SELECT 商品コード、商品名、単価、商品区分、関連商品コード FROM 商品;

問題2　正解
商品テーブルの全ての商品名を抽出する

解答2
SELECT 商品名 FROM 商品;

問題3　正解
注文テーブルの全てのデータを抽出する「※」を用いること

解答3
SELECT * FROM 注文;

問題4　正解
注文テーブルの注文番号、注文枝番、商品コードを抽出する「※」を用いること

解答4
SELECT 注文番号 注文枝番 商品コード FROM 注文;

問題5　正解
商品テーブルに次のデータを追加する

商品コード　W0461
商品名　冬のあったかコート
単価 12800
商品区分 1

解答5
INSERT INTO 商品(商品コード, 商品名, 単価, 商品区分) VALUES (W0461, 冬のあったかコート, 12800, 1);

## Level2(本誌 第3章)
問題6　正解
商品テーブルから商品コードが「W1252」のデータを抽出する

解答6
SELECT * FROM 商品 WHERE 商品コード = 'W1252';

問題7　正解
商品コードが「S0023」の商品について、商品テーブルの単価を500円に変更する

解答7
UPDATE 商品 SET 単価 = 500 WHERE 商品コード = ’S0023’;

問題8　正解
商品テーブルから、単価が1,000円以下の商品データを抽出する

解答8
SELECT * FROM 商品 WHERE 単価 <= 1000;

問題9　正解
商品テーブルから、単価が50,000円以上の商品データを抽出する

解答9
SELECT * FROM 商品 WHERE 単価 >= 50000;

問題10　正解
注文テーブルから、2018年以降の注文データを抽出する

解答10
SELECT * FROM 注文 WHERE 注文日 >= '2018-01-01';

問題11　正解
注文テーブルから、2017年11月以前の注文データを抽出する

解答11
SELECT * FROM 注文 WHERE 注文日 < '2017-12-01';

問題12　正解
商品テーブルから、「衣類」でない商品データを抽出する

解答12
SELECT * FROM 商品 WHERE 商品区分 <> '1';

問題13　正解
注文テーブルから、クーポン割引を利用していない注文データを抽出する

解答13
SELECT * FROM 注文 WHERE クーポン割引料 IS NULL;

問題14　正解
商品テーブルから、商品コードが「N」で始まる商品を削除する

解答14
DELETE FROM 商品 WHERE 商品コード LIKE 'N%';

問題15　正解
商品テーブルから、商品名に「コート」が含まれる商品について、商品コード、商品名、単価を抽出する

解答15
SELECT 商品コード, 商品名, 単価 FROM 商品 WHERE 商品名 LIKE '%コート%';

問題16　不正解
「靴」または「雑貨」もしくは「未分類」の商品について、商品コード、商品区分を抽出する。記述する条件式は1つであること

解答16
SELECT 商品コード, 商品区分 FROM 商品 WHERE 商品区分 = '2' OR 商品区分 = '3' OR 商品区分 = '9';

SELECT 商品コード, 商品区分 FROM 商品 WHERE 商品区分 IN ('2','3','9');

問題17　正解
商品テーブルから、商品コードが「A0100」~「A0500」に当てはまる商品データを抽出する。記述する条件式は1つであること。

解答17
SELECT * FROM 商品 WHERE 商品コード BETWEEN 'A0100' AND 'A0500';

問題18　正解
注文テーブルから、商品コードが「N0501」「N1021」「N0223」のいずれかを注文した注文データを抽出する

解答18
SELECT * FROM 注文 WHERE 商品コード IN ('N0501','N1021', 'N0223');

問題19　正解
商品テーブルから、「雑貨」で商品名に「水玉」が含まれる商品データを抽出する

解答19
SELECT * FROM 商品 WHERE 商品区分 = '3' AND 商品名 LIKE '%水玉%';

問題20　正解
商品テーブルから、商品名に「軽い」または「ゆるふわ」のどちらかが含まれる商品データを抽出する

解答20
SELECT * FROM 商品 WHERE 商品名 LIKE '%軽い%' OR 商品名 LIKE '%ゆるふわ%';

問題21　正解
商品テーブルから、「衣類」で単価が3,000円以下、または「雑貨」で単価が10,000円以上の商品データを抽出する

解答21
SELECT * FROM 商品 WHERE (商品区分 = '1' AND 単価 <= 3000) OR (商品区分 = '3' AND 単価 >= 10000);

問題22　正解
注文テーブルから、2018年3月中に、一度の注文で数量3個以上の注文があった商品コードを抽出する。

解答22
SELECT * FROM 注文 WHERE 注文日 >= '2018-03-01' AND 注文日 <= '2018-03-31' AND 数量 >= 3;

問題23　正解
注文テーブルから、一度の注文で数量10個以上を注文したか、クーポン割引を利用した注文データを抽出する。

解答23
SELECT * FROM 注文 WHERE 数量 >= 10 OR クーポン割引量 IS NOT NULL;

問題24　正解
商品テーブルと注文テーブルそれぞれについて、主キーの役割を果たしている列名を日本語で解答する。

解答24
商品データ：商品コード
注文データ：注文日、注文番号、注文枝番

問題25　正解
商品区分「衣類」の商品について、商品コードの降順に商品コードと商品名の一覧を取得する。

解答25
SELECT 商品コード、商品名 FROM 商品 WHERE 商品区分 = '1' ORDER BY 商品コード DESC;

問題26　正解
注文テーブルから、主キーの昇順に2018年3月以降の注文一覧を取得する。取得する項目は、注文日、注文番号、注文枝番、商品コード、数量とする。

解答26
SELECT 注文日、注文番号、注文枝番、商品コード, 数量 FROM 注文 WHERE 注文日 >= '2018-03-01' ORDER BY 注文日、注文番号、注文枝番;

問題27　正解　
注文テーブルから、これまでに注文のあった商品コードを抽出する。重複は除外し、商品コードの昇順に抽出すること。

解答27
SELECT DISTINCT 商品コード FROM 注文 ORDER BY 商品コード;

問題28　不正解
注文テーブルから、注文のあった日付を新しい順に10行抽出する(同一行が複数回登場しても良い)

解答28
SELECT 注文日 FROM 注文 ORDER BY 注文日 DESC;
SELECT 注文日 FROM 注文 ORDER BY 注文日 DESC OFFSET 0 FETCH FIRST 10 ROW　ONLY;

問題29　正解　
商品テーブルから、単価の低い順に並べて6〜20行目に当たる商品データを抽出する。同一単価の場合は、商品区分、商品コードの昇順に抽出する。

解答29
SELECT * FROM 商品 ORDER BY 単価, 商品区分, 商品コード OFFSET 5 FETCH FIRST 15 ROWS ONLY;

問題30　不正解
廃番商品テーブルから、2016年12月に廃番されたものと、売上個数が100を超えるものを併せて抽出する。一覧は、売上個数の多い順に並べること。

解答30
SELECT * FROM 廃藩商品 WHERE 廃番日 >= '2016-12-01' AND 廃番日 <= '2016-12-31' AND 売上個数 > 100 ORDER BY 売上個数 DESC;

SELECT * FROM 廃藩商品 WHERE 廃番日 >= '2016-12-01' AND 廃番日 <= '2016-12-31' UNION SELECT * FROM 廃番商品 WHERE 売上個数 > 100 ORDER BY 6 DESC;

問題31　正解
廃番商品テーブルから、2016年12月に廃番されたものと、売上個数が100を超えるものを併せて抽出する。一覧は、売上個数の多い順に並べること。

解答31
SELECT 商品コード FROM EXCEPT SELECT 商品コード FROM 注文 ORDER BY 商品コード;

問題32　
商品テーブルから、これまでに注文された実績のある商品コードを商品コードの降順に抽出する

解答32
SELECT 商品コード FROM INTERSECT SELECT 商品コード FROM 注文 ORDER BY 商品コード DESC;

問題33 不正解
商品区分が「未分類」で単価が1,000円以下と1万円を超える商品について、商品コード、商品名、単価を抽出する。単価の低い順に並べ、同類の場合は商品コードの昇順とする。

解答33
SELECT 商品コード, 商品名, 単価 FORM 商品 WHERE 商品区分 = '9' AND 単価 <= 1000 UNION SELECT 商品コード, 商品名, 単価 FROM 商品 WHERE 単価 > 10000 ORDER BY 商品コード;

SELECT 商品コード, 商品名, 単価 FORM 商品 WHERE 商品区分 = '9' AND 単価 <= 1000 UNION SELECT 商品コード, 商品名, 単価 FROM 商品 WHERE 商品区分 = '9' AND 単価 > 10000 ORDER BY 商品コード;

問題34　正解
商品テーブルの商品区分「未分類」の商品について、商品コード、単価、キャンペーン価格の一覧を取得する。キャンペーン価格は単価の5%引きであり、1円未満の端数は考慮しなくて良い。一覧は商品コード順に並べること。

解答34
SELECT 商品コード, 単価, 単価 * 0.95 AS キャンペーン価格 FORM 商品 WHERE 商品区分 = '9' ORDER BY 商品コード;

問題35　正解
注文日が2018年3月12~14日で、同じ商品を2個以上注文し、すでにクーポン割引を利用している注文について、さらに300円割引することになった。該当データのクーポン割引料を更新する。

解答35
UPDATE 注文 SET 割引料 = 割引料 + 300 WHERE 注文日 >= '2018-03-12' AND 注文日 <= '2018-03-14' AND 数量 = 2 AND クーポン割引料 IS NOT NULL;

問題36
注文日が2018年3月12~14日で、同じ商品を2個以上注文し、すでにクーポン割引を利用している注文について、さらに300円割引することになった。該当データのクーポン割引料を更新する。

解答36
UPDATE 注文 SET 数量 =  数量 - 1 WHERE 注文番号 = '201802250126' AND 商品コード = 'W0156';

問題37　不正解
注文テーブルから、注文番号「201710010001」〜「201710319999」の注文データを抽出する。注文番号と枝番は、「-」でつなげて1つの項目として抽出する。

解答37
SELECT 注文日 注文番号 || '-' || CAST(注文枝番 AS VARCHAR) FROM 注文 WHERE 注文番号 >= '20170010001' AND 注文番号 <= '201710319999';

問題38　正解
商品テーブルから、商品区分の一覧を取得する。見出しは「区分」と「区分名」とし、区分名には日本語名を表記する。

解答38
SELECT DISTINCT 商品区分 AS 区分, CASE 商品区分 WHEN '1' THEN '衣類' WHEN '2' THEN '靴' WHEN '3' THEN '雑貨' WHEN '9' THEN '未分類' END AS 区分名 FROM 商品;

問題39　正解
商品テーブルから、商品コード、商品名、単価、販売価格ランク、商品区分を抽出する。販売価格ランクは、3千円未満を「S」、3千円以上1万円未満を「M」、1万円以上を「L」とする。また商品区分はコードと日本語名称を「：」(コロン)で連結して表記する。一覧は、単価の昇順に並べ、同額の場合は商品コードの昇順に並べること。

解答39
SELECT 商品コード, 商品名, 単価, CASE WHEN 単価 < 3000 THEN 'S' WHEN 単価 >= 3000 AND 単価 < 10000 THEN 'M' ELSE 'L' END AS 販売価格ランク, 商品区分 || ':' || CASE 商品区分 WHEN '1' THEN '衣類' WHEN '2' THEN '靴' WHEN '3' THEN '雑貨' WHEN '9' THHEN '未分類' END AS 商品区分 ORDER BY 単価, 商品コード;

問題40　
商品テーブルから、商品名が10文字を超過する商品名とその文字数を抽出する。文字数の昇順に並べること。

解答
SELECT 商品名, LENGTH(商品名) AS 文字数 FROM 商品 WHERE LENGTH(商品名) > 10 ORDER BY LENGTH(商品名);
